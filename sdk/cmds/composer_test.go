package cmds

import "testing"

func Test_parseComposerAudit(t *testing.T) {
	testdata := "{\n    \"advisories\": {\n        \"guzzlehttp/guzzle\": [\n            {\n                \"title\": \"Change in port should be considered a change in origin\",\n                \"cve\": \"CVE-2022-31091\",\n                \"link\": \"https://github.com/guzzle/guzzle/security/advisories/GHSA-q559-8m2m-g699\",\n                \"reportedAt\": \"2022-06-20T22:24:00+00:00\",\n                \"sources\": [\n                    {\n                        \"name\": \"GitHub\",\n                        \"remoteId\": \"GHSA-q559-8m2m-g699\"\n                    },\n                    {\n                        \"name\": \"FriendsOfPHP/security-advisories\",\n                        \"remoteId\": \"guzzlehttp/guzzle/CVE-2022-31091.yaml\"\n                    }\n                ],\n                \"advisoryId\": \"PKSA-yfw5-9gnj-n2c7\",\n                \"packageName\": \"guzzlehttp/guzzle\",\n                \"affectedVersions\": \">=7,<7.4.5|>=4,<6.5.8\"\n            },\n            {\n                \"title\": \"CURLOPT_HTTPAUTH option not cleared on change of origin\",\n                \"cve\": \"CVE-2022-31090\",\n                \"link\": \"https://github.com/guzzle/guzzle/security/advisories/GHSA-25mq-v84q-4j7r\",\n                \"reportedAt\": \"2022-06-20T22:24:00+00:00\",\n                \"sources\": [\n                    {\n                        \"name\": \"GitHub\",\n                        \"remoteId\": \"GHSA-25mq-v84q-4j7r\"\n                    },\n                    {\n                        \"name\": \"FriendsOfPHP/security-advisories\",\n                        \"remoteId\": \"guzzlehttp/guzzle/CVE-2022-31090.yaml\"\n                    }\n                ],\n                \"advisoryId\": \"PKSA-k1b4-kshy-xgbh\",\n                \"packageName\": \"guzzlehttp/guzzle\",\n                \"affectedVersions\": \">=7,<7.4.5|>=4,<6.5.8\"\n            },\n            {\n                \"title\": \"Fix failure to strip Authorization header on HTTP downgrade\",\n                \"cve\": \"CVE-2022-31043\",\n                \"link\": \"https://github.com/guzzle/guzzle/security/advisories/GHSA-w248-ffj2-4v5q\",\n                \"reportedAt\": \"2022-06-09T23:36:00+00:00\",\n                \"sources\": [\n                    {\n                        \"name\": \"GitHub\",\n                        \"remoteId\": \"GHSA-w248-ffj2-4v5q\"\n                    },\n                    {\n                        \"name\": \"FriendsOfPHP/security-advisories\",\n                        \"remoteId\": \"guzzlehttp/guzzle/CVE-2022-31043.yaml\"\n                    }\n                ],\n                \"advisoryId\": \"PKSA-2z36-j4q9-rsfy\",\n                \"packageName\": \"guzzlehttp/guzzle\",\n                \"affectedVersions\": \">=7,<7.4.4|>=4,<6.5.7\"\n            },\n            {\n                \"title\": \"Failure to strip the Cookie header on change in host or HTTP downgrade\",\n                \"cve\": \"CVE-2022-31042\",\n                \"link\": \"https://github.com/guzzle/guzzle/security/advisories/GHSA-f2wf-25xc-69c9\",\n                \"reportedAt\": \"2022-06-09T23:36:00+00:00\",\n                \"sources\": [\n                    {\n                        \"name\": \"GitHub\",\n                        \"remoteId\": \"GHSA-f2wf-25xc-69c9\"\n                    },\n                    {\n                        \"name\": \"FriendsOfPHP/security-advisories\",\n                        \"remoteId\": \"guzzlehttp/guzzle/CVE-2022-31042.yaml\"\n                    }\n                ],\n                \"advisoryId\": \"PKSA-fvw5-9t6n-nwvr\",\n                \"packageName\": \"guzzlehttp/guzzle\",\n                \"affectedVersions\": \">=7,<7.4.4|>=4,<6.5.7\"\n            },\n            {\n                \"title\": \"Cross-domain cookie leakage\",\n                \"cve\": \"CVE-2022-29248\",\n                \"link\": \"https://github.com/guzzle/guzzle/security/advisories/GHSA-cwmx-hcrq-mhc3\",\n                \"reportedAt\": \"2022-05-25T13:21:00+00:00\",\n                \"sources\": [\n                    {\n                        \"name\": \"GitHub\",\n                        \"remoteId\": \"GHSA-cwmx-hcrq-mhc3\"\n                    },\n                    {\n                        \"name\": \"FriendsOfPHP/security-advisories\",\n                        \"remoteId\": \"guzzlehttp/guzzle/CVE-2022-29248.yaml\"\n                    }\n                ],\n                \"advisoryId\": \"PKSA-6d8m-6kgw-18zr\",\n                \"packageName\": \"guzzlehttp/guzzle\",\n                \"affectedVersions\": \">=7,<7.4.3|>=4,<6.5.6\"\n            }\n        ],\n        \"guzzlehttp/psr7\": [\n            {\n                \"title\": \"Improper header validation\",\n                \"cve\": \"CVE-2023-29197\",\n                \"link\": \"https://github.com/guzzle/psr7/security/advisories/GHSA-wxmh-65f7-jcvw\",\n                \"reportedAt\": \"2023-04-17T16:00:00+00:00\",\n                \"sources\": [\n                    {\n                        \"name\": \"GitHub\",\n                        \"remoteId\": \"GHSA-wxmh-65f7-jcvw\"\n                    },\n                    {\n                        \"name\": \"FriendsOfPHP/security-advisories\",\n                        \"remoteId\": \"guzzlehttp/psr7/CVE-2023-29197.yaml\"\n                    }\n                ],\n                \"advisoryId\": \"PKSA-hn62-zkx4-1y5q\",\n                \"packageName\": \"guzzlehttp/psr7\",\n                \"affectedVersions\": \">=2,<2.4.5|<1.9.1\"\n            },\n            {\n                \"title\": \"Inproper parsing of HTTP headers\",\n                \"cve\": \"CVE-2022-24775\",\n                \"link\": \"https://github.com/guzzle/psr7/security/advisories/GHSA-q7rv-6hp3-vh96\",\n                \"reportedAt\": \"2022-03-20T13:44:00+00:00\",\n                \"sources\": [\n                    {\n                        \"name\": \"GitHub\",\n                        \"remoteId\": \"GHSA-q7rv-6hp3-vh96\"\n                    },\n                    {\n                        \"name\": \"FriendsOfPHP/security-advisories\",\n                        \"remoteId\": \"guzzlehttp/psr7/CVE-2022-24775.yaml\"\n                    }\n                ],\n                \"advisoryId\": \"PKSA-gvzg-s447-b5b5\",\n                \"packageName\": \"guzzlehttp/psr7\",\n                \"affectedVersions\": \">=2,<2.1.1|<1.8.4\"\n            }\n        ],\n        \"laravel/fortify\": [\n            {\n                \"title\": \"Multi-Factor Authentication issue in Laravel Fortify\",\n                \"cve\": \"CVE-2022-25838\",\n                \"link\": \"https://github.com/advisories/GHSA-6w4v-qr4m-97gg\",\n                \"reportedAt\": \"2022-02-23T16:04:00+00:00\",\n                \"sources\": [\n                    {\n                        \"name\": \"GitHub\",\n                        \"remoteId\": \"GHSA-6w4v-qr4m-97gg\"\n                    },\n                    {\n                        \"name\": \"FriendsOfPHP/security-advisories\",\n                        \"remoteId\": \"laravel/fortify/CVE-2022-25838.yaml\"\n                    }\n                ],\n                \"advisoryId\": \"PKSA-d885-j9vg-vvzx\",\n                \"packageName\": \"laravel/fortify\",\n                \"affectedVersions\": \"<1.11.1\"\n            }\n        ],\n        \"nyholm/psr7\": [\n            {\n                \"title\": \"Improper Input Validation in headers\",\n                \"cve\": null,\n                \"link\": \"https://github.com/advisories/GHSA-wjfc-pgfp-pv9c\",\n                \"reportedAt\": \"2023-04-17T00:00:00+00:00\",\n                \"sources\": [\n                    {\n                        \"name\": \"GitHub\",\n                        \"remoteId\": \"GHSA-wjfc-pgfp-pv9c\"\n                    },\n                    {\n                        \"name\": \"FriendsOfPHP/security-advisories\",\n                        \"remoteId\": \"nyholm/psr7/2023-04-17.yaml\"\n                    }\n                ],\n                \"advisoryId\": \"PKSA-8ds9-sp96-ghmb\",\n                \"packageName\": \"nyholm/psr7\",\n                \"affectedVersions\": \"<1.6.1\"\n            }\n        ],\n        \"phpseclib/phpseclib\": [\n            {\n                \"title\": \"Infinite Loop vulnerability\",\n                \"cve\": \"CVE-2023-27560\",\n                \"link\": \"https://github.com/advisories/GHSA-hm7p-r324-hhf3\",\n                \"reportedAt\": \"2023-03-06T09:20:00+00:00\",\n                \"sources\": [\n                    {\n                        \"name\": \"GitHub\",\n                        \"remoteId\": \"GHSA-hm7p-r324-hhf3\"\n                    },\n                    {\n                        \"name\": \"FriendsOfPHP/security-advisories\",\n                        \"remoteId\": \"phpseclib/phpseclib/CVE-2023-27560.yaml\"\n                    }\n                ],\n                \"advisoryId\": \"PKSA-qrgb-4pgm-cz41\",\n                \"packageName\": \"phpseclib/phpseclib\",\n                \"affectedVersions\": \">=3.0.0,<3.0.19\"\n            }\n        ],\n        \"react/http\": [\n            {\n                \"title\": \"ReactPHP's HTTP server continues parsing unused multipart parts after reaching limits\",\n                \"cve\": \"CVE-2023-26044\",\n                \"link\": \"https://github.com/advisories/GHSA-95x4-j7vc-h8mf\",\n                \"reportedAt\": \"2023-02-27T15:05:00+00:00\",\n                \"sources\": [\n                    {\n                        \"name\": \"GitHub\",\n                        \"remoteId\": \"GHSA-95x4-j7vc-h8mf\"\n                    },\n                    {\n                        \"name\": \"FriendsOfPHP/security-advisories\",\n                        \"remoteId\": \"react/http/CVE-2023-26044.yaml\"\n                    }\n                ],\n                \"advisoryId\": \"PKSA-wsbn-q9bd-w7z2\",\n                \"packageName\": \"react/http\",\n                \"affectedVersions\": \">=0.8.0,<1.9.0\"\n            },\n            {\n                \"title\": \"ReactPHP's HTTP server parses encoded cookie names so malicious `__Host-` and `__Secure-` cookies can be sent\",\n                \"cve\": \"CVE-2022-36032\",\n                \"link\": \"https://github.com/advisories/GHSA-w3w9-vrf5-8mx8\",\n                \"reportedAt\": \"2022-08-20T11:11:00+00:00\",\n                \"sources\": [\n                    {\n                        \"name\": \"GitHub\",\n                        \"remoteId\": \"GHSA-w3w9-vrf5-8mx8\"\n                    },\n                    {\n                        \"name\": \"FriendsOfPHP/security-advisories\",\n                        \"remoteId\": \"react/http/CVE-2022-36032.yaml\"\n                    }\n                ],\n                \"advisoryId\": \"PKSA-kwfb-dvpm-qtpb\",\n                \"packageName\": \"react/http\",\n                \"affectedVersions\": \">=0.7.0,<1.7.0\"\n            }\n        ],\n        \"symfony/http-kernel\": [\n            {\n                \"title\": \"CVE-2022-24894: Prevent storing cookie headers in HttpCache\",\n                \"cve\": \"CVE-2022-24894\",\n                \"link\": \"https://symfony.com/cve-2022-24894\",\n                \"reportedAt\": \"2023-02-01T08:00:00+00:00\",\n                \"sources\": [\n                    {\n                        \"name\": \"GitHub\",\n                        \"remoteId\": \"GHSA-h7vf-5wrv-9fhv\"\n                    },\n                    {\n                        \"name\": \"FriendsOfPHP/security-advisories\",\n                        \"remoteId\": \"symfony/http-kernel/CVE-2022-24894.yaml\"\n                    }\n                ],\n                \"advisoryId\": \"PKSA-hr4y-jwk2-1yb9\",\n                \"packageName\": \"symfony/http-kernel\",\n                \"affectedVersions\": \">=2.0.0,<2.1.0|>=2.1.0,<2.2.0|>=2.2.0,<2.3.0|>=2.3.0,<2.4.0|>=2.4.0,<2.5.0|>=2.5.0,<2.6.0|>=2.6.0,<2.7.0|>=2.7.0,<2.8.0|>=2.8.0,<3.0.0|>=3.0.0,<3.1.0|>=3.1.0,<3.2.0|>=3.2.0,<3.3.0|>=3.3.0,<3.4.0|>=3.4.0,<4.0.0|>=4.0.0,<4.1.0|>=4.1.0,<4.2.0|>=4.2.0,<4.3.0|>=4.3.0,<4.4.0|>=4.4.0,<4.4.50|>=5.0.0,<5.1.0|>=5.1.0,<5.2.0|>=5.2.0,<5.3.0|>=5.3.0,<5.4.0|>=5.4.0,<5.4.20|>=6.0.0,<6.0.20|>=6.1.0,<6.1.12|>=6.2.0,<6.2.6\"\n            }\n        ]\n    },\n    \"abandoned\": {\n        \"fzaninotto/faker\": null,\n        \"moontoast/math\": \"brick/math\",\n        \"swiftmailer/swiftmailer\": \"symfony/mailer\"\n    }\n}\n"

	parsedAudit := parseComposerAudit(testdata)

	//check if it is stall an json
	if parsedAudit[0] == '{' {
		t.Errorf("wanted to have text, not a json string here")
	}
}

func Test_parseComposerAuditWithCorruptJson(t *testing.T) {
	testdata := "{\"advisories\": \n        \"guzzlehttp/guzzle\": [\n            {\n                \"title\": \"Change in port should be considered a change in origin\",\n                \"cve\": \"CVE-2022-31091\",\n                \"link\": \"https://github.com/guzzle/guzzle/security/advisories/GHSA-q559-8m2m-g699\",\n                \"reportedAt\": \"2022-06-20T22:24:00+00:00\",\n                \"sources\": [\n                    {\n                        \"name\": \"GitHub\",\n                        \"remoteId\": \"GHSA-q559-8m2m-g699\"\n                    },\n                    {\n                        \"name\": \"FriendsOfPHP/security-advisories\",\n                        \"remoteId\": \"guzzlehttp/guzzle/CVE-2022-31091.yaml\"\n                    }\n                ],\n                \"advisoryId\": \"PKSA-yfw5-9gnj-n2c7\",\n                \"packageName\": \"guzzlehttp/guzzle\",\n                \"affectedVersions\": \">=7,<7.4.5|>=4,<6.5.8\"\n            },\n            {\n                \"title\": \"CURLOPT_HTTPAUTH option not cleared on change of origin\",\n                \"cve\": \"CVE-2022-31090\",\n                \"link\": \"https://github.com/guzzle/guzzle/security/advisories/GHSA-25mq-v84q-4j7r\",\n                \"reportedAt\": \"2022-06-20T22:24:00+00:00\",\n                \"sources\": [\n                    {\n                        \"name\": \"GitHub\",\n                        \"remoteId\": \"GHSA-25mq-v84q-4j7r\"\n                    },\n                    {\n                        \"name\": \"FriendsOfPHP/security-advisories\",\n                        \"remoteId\": \"guzzlehttp/guzzle/CVE-2022-31090.yaml\"\n                    }\n                ],\n                \"advisoryId\": \"PKSA-k1b4-kshy-xgbh\",\n                \"packageName\": \"guzzlehttp/guzzle\",\n                \"affectedVersions\": \">=7,<7.4.5|>=4,<6.5.8\"\n            },\n            {\n                \"title\": \"Fix failure to strip Authorization header on HTTP downgrade\",\n                \"cve\": \"CVE-2022-31043\",\n                \"link\": \"https://github.com/guzzle/guzzle/security/advisories/GHSA-w248-ffj2-4v5q\",\n                \"reportedAt\": \"2022-06-09T23:36:00+00:00\",\n                \"sources\": [\n                    {\n                        \"name\": \"GitHub\",\n                        \"remoteId\": \"GHSA-w248-ffj2-4v5q\"\n                    },\n                    {\n                        \"name\": \"FriendsOfPHP/security-advisories\",\n                        \"remoteId\": \"guzzlehttp/guzzle/CVE-2022-31043.yaml\"\n                    }\n                ],\n                \"advisoryId\": \"PKSA-2z36-j4q9-rsfy\",\n                \"packageName\": \"guzzlehttp/guzzle\",\n                \"affectedVersions\": \">=7,<7.4.4|>=4,<6.5.7\"\n            },\n            {\n                \"title\": \"Failure to strip the Cookie header on change in host or HTTP downgrade\",\n                \"cve\": \"CVE-2022-31042\",\n                \"link\": \"https://github.com/guzzle/guzzle/security/advisories/GHSA-f2wf-25xc-69c9\",\n                \"reportedAt\": \"2022-06-09T23:36:00+00:00\",\n                \"sources\": [\n                    {\n                        \"name\": \"GitHub\",\n                        \"remoteId\": \"GHSA-f2wf-25xc-69c9\"\n                    },\n                    {\n                        \"name\": \"FriendsOfPHP/security-advisories\",\n                        \"remoteId\": \"guzzlehttp/guzzle/CVE-2022-31042.yaml\"\n                    }\n                ],\n                \"advisoryId\": \"PKSA-fvw5-9t6n-nwvr\",\n                \"packageName\": \"guzzlehttp/guzzle\",\n                \"affectedVersions\": \">=7,<7.4.4|>=4,<6.5.7\"\n            },\n            {\n                \"title\": \"Cross-domain cookie leakage\",\n                \"cve\": \"CVE-2022-29248\",\n                \"link\": \"https://github.com/guzzle/guzzle/security/advisories/GHSA-cwmx-hcrq-mhc3\",\n                \"reportedAt\": \"2022-05-25T13:21:00+00:00\",\n                \"sources\": [\n                    {\n                        \"name\": \"GitHub\",\n                        \"remoteId\": \"GHSA-cwmx-hcrq-mhc3\"\n                    },\n                    {\n                        \"name\": \"FriendsOfPHP/security-advisories\",\n                        \"remoteId\": \"guzzlehttp/guzzle/CVE-2022-29248.yaml\"\n                    }\n                ],\n                \"advisoryId\": \"PKSA-6d8m-6kgw-18zr\",\n                \"packageName\": \"guzzlehttp/guzzle\",\n                \"affectedVersions\": \">=7,<7.4.3|>=4,<6.5.6\"\n            }\n        ],\n        \"guzzlehttp/psr7\": [\n            {\n                \"title\": \"Improper header validation\",\n                \"cve\": \"CVE-2023-29197\",\n                \"link\": \"https://github.com/guzzle/psr7/security/advisories/GHSA-wxmh-65f7-jcvw\",\n                \"reportedAt\": \"2023-04-17T16:00:00+00:00\",\n                \"sources\": [\n                    {\n                        \"name\": \"GitHub\",\n                        \"remoteId\": \"GHSA-wxmh-65f7-jcvw\"\n                    },\n                    {\n                        \"name\": \"FriendsOfPHP/security-advisories\",\n                        \"remoteId\": \"guzzlehttp/psr7/CVE-2023-29197.yaml\"\n                    }\n                ],\n                \"advisoryId\": \"PKSA-hn62-zkx4-1y5q\",\n                \"packageName\": \"guzzlehttp/psr7\",\n                \"affectedVersions\": \">=2,<2.4.5|<1.9.1\"\n            },\n            {\n                \"title\": \"Inproper parsing of HTTP headers\",\n                \"cve\": \"CVE-2022-24775\",\n                \"link\": \"https://github.com/guzzle/psr7/security/advisories/GHSA-q7rv-6hp3-vh96\",\n                \"reportedAt\": \"2022-03-20T13:44:00+00:00\",\n                \"sources\": [\n                    {\n                        \"name\": \"GitHub\",\n                        \"remoteId\": \"GHSA-q7rv-6hp3-vh96\"\n                    },\n                    {\n                        \"name\": \"FriendsOfPHP/security-advisories\",\n                        \"remoteId\": \"guzzlehttp/psr7/CVE-2022-24775.yaml\"\n                    }\n                ],\n                \"advisoryId\": \"PKSA-gvzg-s447-b5b5\",\n                \"packageName\": \"guzzlehttp/psr7\",\n                \"affectedVersions\": \">=2,<2.1.1|<1.8.4\"\n            }\n        ],\n        \"laravel/fortify\": [\n            {\n                \"title\": \"Multi-Factor Authentication issue in Laravel Fortify\",\n                \"cve\": \"CVE-2022-25838\",\n                \"link\": \"https://github.com/advisories/GHSA-6w4v-qr4m-97gg\",\n                \"reportedAt\": \"2022-02-23T16:04:00+00:00\",\n                \"sources\": [\n                    {\n                        \"name\": \"GitHub\",\n                        \"remoteId\": \"GHSA-6w4v-qr4m-97gg\"\n                    },\n                    {\n                        \"name\": \"FriendsOfPHP/security-advisories\",\n                        \"remoteId\": \"laravel/fortify/CVE-2022-25838.yaml\"\n                    }\n                ],\n                \"advisoryId\": \"PKSA-d885-j9vg-vvzx\",\n                \"packageName\": \"laravel/fortify\",\n                \"affectedVersions\": \"<1.11.1\"\n            }\n        ],\n        \"nyholm/psr7\": [\n            {\n                \"title\": \"Improper Input Validation in headers\",\n                \"cve\": null,\n                \"link\": \"https://github.com/advisories/GHSA-wjfc-pgfp-pv9c\",\n                \"reportedAt\": \"2023-04-17T00:00:00+00:00\",\n                \"sources\": [\n                    {\n                        \"name\": \"GitHub\",\n                        \"remoteId\": \"GHSA-wjfc-pgfp-pv9c\"\n                    },\n                    {\n                        \"name\": \"FriendsOfPHP/security-advisories\",\n                        \"remoteId\": \"nyholm/psr7/2023-04-17.yaml\"\n                    }\n                ],\n                \"advisoryId\": \"PKSA-8ds9-sp96-ghmb\",\n                \"packageName\": \"nyholm/psr7\",\n                \"affectedVersions\": \"<1.6.1\"\n            }\n        ],\n        \"phpseclib/phpseclib\": [\n            {\n                \"title\": \"Infinite Loop vulnerability\",\n                \"cve\": \"CVE-2023-27560\",\n                \"link\": \"https://github.com/advisories/GHSA-hm7p-r324-hhf3\",\n                \"reportedAt\": \"2023-03-06T09:20:00+00:00\",\n                \"sources\": [\n                    {\n                        \"name\": \"GitHub\",\n                        \"remoteId\": \"GHSA-hm7p-r324-hhf3\"\n                    },\n                    {\n                        \"name\": \"FriendsOfPHP/security-advisories\",\n                        \"remoteId\": \"phpseclib/phpseclib/CVE-2023-27560.yaml\"\n                    }\n                ],\n                \"advisoryId\": \"PKSA-qrgb-4pgm-cz41\",\n                \"packageName\": \"phpseclib/phpseclib\",\n                \"affectedVersions\": \">=3.0.0,<3.0.19\"\n            }\n        ],\n        \"react/http\": [\n            {\n                \"title\": \"ReactPHP's HTTP server continues parsing unused multipart parts after reaching limits\",\n                \"cve\": \"CVE-2023-26044\",\n                \"link\": \"https://github.com/advisories/GHSA-95x4-j7vc-h8mf\",\n                \"reportedAt\": \"2023-02-27T15:05:00+00:00\",\n                \"sources\": [\n                    {\n                        \"name\": \"GitHub\",\n                        \"remoteId\": \"GHSA-95x4-j7vc-h8mf\"\n                    },\n                    {\n                        \"name\": \"FriendsOfPHP/security-advisories\",\n                        \"remoteId\": \"react/http/CVE-2023-26044.yaml\"\n                    }\n                ],\n                \"advisoryId\": \"PKSA-wsbn-q9bd-w7z2\",\n                \"packageName\": \"react/http\",\n                \"affectedVersions\": \">=0.8.0,<1.9.0\"\n            },\n            {\n                \"title\": \"ReactPHP's HTTP server parses encoded cookie names so malicious `__Host-` and `__Secure-` cookies can be sent\",\n                \"cve\": \"CVE-2022-36032\",\n                \"link\": \"https://github.com/advisories/GHSA-w3w9-vrf5-8mx8\",\n                \"reportedAt\": \"2022-08-20T11:11:00+00:00\",\n                \"sources\": [\n                    {\n                        \"name\": \"GitHub\",\n                        \"remoteId\": \"GHSA-w3w9-vrf5-8mx8\"\n                    },\n                    {\n                        \"name\": \"FriendsOfPHP/security-advisories\",\n                        \"remoteId\": \"react/http/CVE-2022-36032.yaml\"\n                    }\n                ],\n                \"advisoryId\": \"PKSA-kwfb-dvpm-qtpb\",\n                \"packageName\": \"react/http\",\n                \"affectedVersions\": \">=0.7.0,<1.7.0\"\n            }\n        ],\n        \"symfony/http-kernel\": [\n            {\n                \"title\": \"CVE-2022-24894: Prevent storing cookie headers in HttpCache\",\n                \"cve\": \"CVE-2022-24894\",\n                \"link\": \"https://symfony.com/cve-2022-24894\",\n                \"reportedAt\": \"2023-02-01T08:00:00+00:00\",\n                \"sources\": [\n                    {\n                        \"name\": \"GitHub\",\n                        \"remoteId\": \"GHSA-h7vf-5wrv-9fhv\"\n                    },\n                    {\n                        \"name\": \"FriendsOfPHP/security-advisories\",\n                        \"remoteId\": \"symfony/http-kernel/CVE-2022-24894.yaml\"\n                    }\n                ],\n                \"advisoryId\": \"PKSA-hr4y-jwk2-1yb9\",\n                \"packageName\": \"symfony/http-kernel\",\n                \"affectedVersions\": \">=2.0.0,<2.1.0|>=2.1.0,<2.2.0|>=2.2.0,<2.3.0|>=2.3.0,<2.4.0|>=2.4.0,<2.5.0|>=2.5.0,<2.6.0|>=2.6.0,<2.7.0|>=2.7.0,<2.8.0|>=2.8.0,<3.0.0|>=3.0.0,<3.1.0|>=3.1.0,<3.2.0|>=3.2.0,<3.3.0|>=3.3.0,<3.4.0|>=3.4.0,<4.0.0|>=4.0.0,<4.1.0|>=4.1.0,<4.2.0|>=4.2.0,<4.3.0|>=4.3.0,<4.4.0|>=4.4.0,<4.4.50|>=5.0.0,<5.1.0|>=5.1.0,<5.2.0|>=5.2.0,<5.3.0|>=5.3.0,<5.4.0|>=5.4.0,<5.4.20|>=6.0.0,<6.0.20|>=6.1.0,<6.1.12|>=6.2.0,<6.2.6\"\n            }\n        ]\n    },\n    \"abandoned\": {\n        \"fzaninotto/faker\": null,\n        \"moontoast/math\": \"brick/math\",\n        \"swiftmailer/swiftmailer\": \"symfony/mailer\"\n    }\n}\n"

	parsedAudit := parseComposerAudit(testdata)

	//check if it is stall an json
	if parsedAudit[0] != '{' {
		t.Errorf("wanted to have a panic defer working; have %s", parsedAudit)
	}
}
